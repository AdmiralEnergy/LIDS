The deployment is failing with "The deployment failed to initialize due to a configuration or code error." The server is not starting or not listening on port 5000.

Please fix the following issues:

## 1. Add startup error handling in server/index.ts

Wrap the entire server initialization in a try-catch and add logging at the very top of the file:

```typescript
console.log("=== SERVER STARTING ===");
console.log("NODE_ENV:", process.env.NODE_ENV);
console.log("PORT:", process.env.PORT || 5000);
And wrap the httpServer.listen() in try-catch:

try {
  httpServer.listen({ port, host: "0.0.0.0", reusePort: true }, () => {
    log(`Server listening on port ${port}`);
  });
} catch (error) {
  console.error("FATAL: Server failed to start:", error);
  process.exit(1);
}
2. Verify production static file serving in server/index.ts
Ensure the production block correctly serves built assets from dist/public:

if (app.get("env") === "production" || process.env.NODE_ENV === "production") {
  const distPath = path.resolve(process.cwd(), "dist/public");
  console.log("Serving static files from:", distPath);
  app.use(express.static(distPath));
  app.get("*", (_req, res) => {
    res.sendFile(path.join(distPath, "index.html"));
  });
}
3. Add graceful database fallback
If any code imports from drizzle/db but DATABASE_URL is not set, it will crash. Add a check at the top of any db-related file:

if (!process.env.DATABASE_URL) {
  console.warn("DATABASE_URL not set - using in-memory storage");
}
4. Verify the build output exists
After running npm run build, confirm these files exist:
dist/index.cjs (server bundle)
dist/public/index.html (client build)
dist/public/assets/ (client assets)
5. Test locally before deploying
Run these commands in the Shell and report any errors:

npm run build
NODE_ENV=production node dist/index.cjs
Please implement these fixes and show me any errors you find in the logs.


---

Paste that into Replit AI chat and it should diagnose and fix the deployment issue.